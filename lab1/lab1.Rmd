---
title: "Quant II - Lab 1"
author: "Sylvan Zheng"
fig_caption: yes
output: pdf_document
editor_options: 
  chunk_output_type: inline
---


# The Science

## Setup
- Download the file `thescience.tsv` from this week's lab folder on GitHub 
- Move the file to a "lab 1" folder on your own computer
- Install the `tidyverse` and `here` R packages if you don't already have them

```{r message=F, warning=F}
knitr::opts_chunk$set(fig.width=4, fig.height=3)
# install.packages(c('tidyverse', 'here'))
library(tidyverse)
library(here)
df <- read_tsv(here('lab1/thescience.tsv'))
```

The data contains the following columns:

- **Potential Outcomes**: `y0` and `y1`
- **Observed Outcome**: `y`
- **Treatment**: `t`

```{r}
df %>% head
```

## Lab Demonstration:

- How does the observed outcome `y` relate to the treatment `t` and the potential outcomes `y0` and `y1`? 

```{r}
df %>% select(y0, y1, t, y) %>% tail
```

- Calculate the difference in means between the treated and the untreated. 
```{r}
mean(filter(df, t == 1)$y) - mean(filter(df, t == 0)$y)
```

- Calculate the true global treatment effect 
```{r}
mean(df$y1 - df$y0)
```

- Explain why they are different. Show this using R.
```{r}
```

- What is the ATE vs the ATC and ATT? How would we calculate these from the science?

# In-Lab Assignment

Do the next part in pairs. Prepare your work using RMarkdown. 

## Fixing the ATE estimation

- You get to play omnipotent being! Create an alternate universe (ie, a new treatment assignment and new outcome variable) such that the difference in means between the treated and the untreated can be reliably estimated.
- Estimate the difference and means and compare it to the true effect.
- Are they different? Why/How? 


## Bias and Consistency of Estimators 

Consider the following estimator for the population mean:
```{r}
my.estimator <- function(data) {
  data[[1]] + 5 / length(data)
}

N <- 5
mu <- 0
sigma <- 1

some.data <- rnorm(N, mu, sigma)
my.estimator(some.data)

some.data <- rnorm(N, mu, sigma)
my.estimator(some.data)

some.data <- rnorm(N, mu, sigma)
my.estimator(some.data)
```

Is this estimator *biased*?

```{r}
estimates <- c()
for(i in 1:1000) {
  some.data <- rnorm(N, mu, sigma)
  e <- my.estimator(some.data)
  estimates <- c(estimates, e)
}
hist(estimates)
mean(estimates)
```

Is this estimator *consistent*?

Is this estimator *asymptotically biased*?
How would we modify the above code to determine this?

Now compare for the following estimator:

```{r}
my.estimator.2 <- function(data) {
  mean(data)
}
```

Write a function that pulls draws 1000 samples of size N
from a normal distribution with mean `mu` and sd `sigma`
and estimates the population mean using the above estimator.

Show a histogram or density plot of a few different values of N.
Does the results suggest consistency? Unbiasedness? Asymptotic unbiasedness?

```{r}
my.estimator.2 <- function(data) {
  mean(data)
}
```

Write a function that pulls draws 1000 samples of size N
from a normal distribution with mean `mu` and sd `sigma`
and estimates the population mean using the above estimator.

Show a histogram or density plot of a few different values of N.
Does the results suggest consistency? Unbiasedness? Asymptotic unbiasedness?